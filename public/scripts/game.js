$(function(){var j=function(a){a=e("chat-user",a);h("chat-login",function(c){c.append(a).append(" has logged in.")})},l=function(a){a=e("chat-user",a);h("chat-logout",function(c){c.append(a).append(" has logged out.")})},k=function(a,c){a=e("chat-user",a);c=e("chat-text",c);h("chat-entry",function(b){b.append(a).append(": ").append(c)})},e=function(a,c){return $("<span></span>").addClass(a).text(c)},h=function(a,c){var b;b=$("<li></li>").addClass(a);c(b);f.append(b);m()},m=function(){var a;a=0;$.each(f.children(),
function(c,b){a+=$(b).outerHeight()});f.scrollTop(a)},n=function(){var a;a=g.val();""!==a.replace(/\s/g,"")&&(k(i,a),g.val(""),d.emit("chat",a))},g,p,f,d,i;g=$("#chat-input");p=$("#chat-send");f=$("#chat-log");m();if(i=prompt("Username:"))d=io.connect("/"),d.on("chat",function(a){k(a.user,a.text)}),d.on("login",function(a){j(a)}),d.on("logout",function(a){l(a)}),d.on("logged in",function(a){$.each(a,function(a,b){"login"===b.type?j(b.user):"text"===b.type?k(b.user,b.text):"logout"===b.type&&l(b.user)});
p.click(n);g.keypress(function(a){13===a.which&&n()});g.removeAttr("disabled");j(i)}),d.on("failed login",function(a){a=e("chat-reason",a);h("chat-fail",function(c){c.append("Failed to login: ").append(a)})}),d.emit("login",{user:i,count:f.children().length})});
